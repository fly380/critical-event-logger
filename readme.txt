== Changelog ==

= 1.1 – 2025-10-20 =
**Added**
* Додано CHANGELOG.md (тепер «Список змін» видно в модалці оновлення WordPress при встановленні з GitHub).
* У логах автоматично позначається виявлений бот у полі повідомлення: … (googlebot|bingbot|…).

**Changed**
* Підсилено перевірку пошукових ботів: реверс DNS + forward-confirm; статуси ok/bad/na потрапляють у кеш.
* Покращено читання хвоста лог-файла для великих файлів та порожніх кейсів.
* Невеликі покращення продуктивності та стабільності AJAX-ендпоїнтів.

**Fixed**
* Тайм-аути RDAP/Cymru/Geo провайдерів збільшені, щоб зменшити помилкові «порожні» відповіді.
* Дрібні правки розмітки й стилів у таблицях адмін-сторінки.


**Added**
* AJAX-перегляд логів з фільтрами рівнів (INFO/WARNING/ERROR/NOTICE/FATAL/DEPRECATED/SCAN) і підсвіткою частих IP.
* Виявлені IP (зведення за частотою) з асинхронним визначенням пулу (BGP/RDAP/RIPE) та гео.
* Блокування: кнопки «Блокувати IP» та «Блокувати пул» (.htaccess для Apache 2.2/2.4, або blocked_ips.txt як fallback).
* Кешування: транзієнти для UA/ботів, пулів (BGP/RDAP/RIPE), геолокації.
* Ротація логів: автоочищення записів старших за 30 днів під час відкриття сторінки.
* Info-модалка в адмінці з описом можливостей плагіна.
* Опція приватності: санітизація PII у нових рядках лога.
* PUC інтеграція для оновлень із GitHub + локальні іконки/банери в модалці «Деталі версії».

**Changed**
* Формат лог-рядка уніфіковано: `[time][ip][username][LEVEL] message`.
* У кеші UA зберігається детекція ботів, додаються бейджі "BOT: Name" з маркуванням ok/bad.

**Fixed**
* Сумісність PHP 7.2–8.3 у бітових операціях та перетвореннях CIDR/діапазонів.
* Стійкіший tail для дуже великих файлів.

= 1.1.1 – 2025-10-30 =
**Added**
* Сторінка адмінки «Боти-винятки» з керуванням списком корисних ботів: Google, Bing, DuckDuck, Applebot, Baidu, Yandex, PetalBot, Ahrefs, Semrush, DotBot, MJ12, Sogou, Exabot, SeznamBot, Qwantify, CCBot, Bytespider, GPTBot/ChatGPT-User, ClaudeBot, PerplexityBot, PhindBot, Omgili.
* Строга перевірка справжності для основних пошукових ботів (rDNS + forward-confirm); для інших — режим UA-only.
* Інтеграція з .htaccess: автоматичний блок **CRIT-BOT-ALLOW** із `SetEnvIfNoCase User-Agent` та змінними середовища `CRIT_ALLOW_*` для умовного обходу IP-блоків.
* GeoBlock-білий список: безпечний обхід блокування для дозволених ботів через `crit_is_allowed_bot()` (з перевіркою rDNS).
* Діагностика на сторінці «Боти-винятки» (поточні UA/IP, збіги за UA, статус дозволу).
* Обмеження кількості бекапів `.htaccess.bak-YYYYMMDD-HHMMSS` до 3 (нове: константа `CRIT_BOT_BAK_KEEP` і фільтр `crit_bot_bak_keep`).

**Changed**
* Меню «Боти-винятки» реєструється з пріоритетом `admin_menu` **99** — гарантовано зʼявляється після батьківського меню.
* У GeoBlock логах тепер лейбляться **всі відомі боти** (через хелпер на базі патернів), а не лише `bingbot`/`SemrushBot`.
* Опції зведено до масиву `crit_allow_bots` (збережено зворотну сумісність із `crit_allow_googlebot`/`crit_allow_bingbot`).
* Ротація бекапів `.htaccess`: залишаємо тільки 3 найновіші.

**Fixed**
* Коректні повідомлення, якщо `.htaccess` недоступний для запису; інструкції для ручної вставки блоку.
* Стабільність визначення реального IP за проксі/CDN; кешування результатів перевірок у transient з TTL.